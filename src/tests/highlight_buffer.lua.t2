;;; ../ntangle-inc
;; attach parser if treesitter highlighter exists
if lang then
	; look for lls attached to hl

	; check that parser is installed

	if parser_installed then
		for _, highlighter in pairs(vim.treesitter.highlighter.active) do
			if highlighter._ntangle_ll and lls[highlighter._ntangle_ll] then
					highlighter.trees[buf] = vim.treesitter.get_parser(buf, lang)
			end
		end
	end
end

;; look for lls attached to hl
local lls = {}
for _ll, _hl in pairs(ll_to_hl) do
	if _hl == hl then
		lls[_ll] = true
	end
end

;; start treesitter highlighter
vim.treesitter.start(ev.buf, nil)

;; check that parser is installed
local found, parsers = pcall(require, "nvim-treesitter.parsers")
local parser_installed = false
if found then
	parser_installed = parsers.has_parser(lang)
end

